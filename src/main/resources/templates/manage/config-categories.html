<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Configuración: Categorías</title>
    <link rel="stylesheet" th:href="@{/css/common-styles.css}">
    <link rel="stylesheet" th:href="@{/css/edit-styles.css}">
    <script th:src="@{/js/confirm-delete.js}"></script>
</head>
<body>

<div class="top-bar" style="display: flex; justify-content: space-between; align-items: center;">
    <h2>Gestión de Categorías</h2>
    <a th:href="${homeUrl}" class="button-link">Volver al Inicio</a>
</div>

<div class="main-container">

    <!-- Navegación Jerárquica: Solo volver a Inicio -->
    <div class="nav-links">
        <a th:href="@{/api/manage/config}">Inicio Configuración</a>
    </div>

    <!-- Mensaje Flash de Actualización (opcional) -->
    <div th:if="${message}" class="alert-message">
        <p th:text="${message}"></p>
    </div>

    <!-- Formulario: Nueva Categoría -->
    <div class="list-container">
        <h3>Añadir Nueva Categoría</h3>
        <form th:action="@{/api/manage/category/create}" method="post">
            <label>Nombre:</label>
            <input type="text" th:field="${newCategory.name}" required style="width: 50%;">
            <br>
            <br>
            <button type="submit">Crear Categoría</button>
        </form>
    </div>

    <!-- Listado de Categorías -->
    <div class="list-container">
        <h3>Listado de Categorías</h3>
        <div th:if="${categories.isEmpty()}" class="no-items-message">
            <p>No hay categorías creadas aún.</p>
        </div>

        <div th:each="category : ${categories}" class="edit-item">
            <div class="item-display">
                <a th:href="@{/api/manage/category/{id}(id=${category.id})}" th:text="${category.name}" style="flex-grow: 1;">
                </a>

                <button
                        th:attr="onclick='document.getElementById(\'edit-form-category-' + ${category.id} + '\').classList.toggle(\'hidden\')'"
                        class="button-small button-edit"
                        style="margin-left: 10px;">
                    Editar
                </button>

                <button type="submit"
                        class="button-small button-delete"
                        th:attr="form='delete-category-form-' + ${category.id}"
                        th:data-category-name="${category.name}"
                        onclick="return confirmDelete(this);"
                        style="margin-left: 5px;">
                    Eliminar
                </button>
            </div>

            <form th:id="'edit-form-category-' + ${category.id}" th:action="@{/api/manage/category/update}" method="post" class="hidden edit-form">
                <input type="hidden" name="id" th:value="${category.id}">
                <label>Editar Nombre:</label>
                <input type="text"
                       name="name"
                       th:id="'category-name-edit-' + ${category.id}"
                       th:value="${category.name}"
                       required
                       style="flex-grow: 1; max-width: 70%;">
                <button type="submit" class="button-small button-save">Guardar</button>
            </form>

            <div style="display:none;">
                <form th:id="'delete-category-form-' + ${category.id}"
                      th:action="@{/api/manage/category/delete/{id}(id=${category.id})}"
                      method="post">
                </form>
            </div>
        </div>
    </div>
</div>

</body>
</html>